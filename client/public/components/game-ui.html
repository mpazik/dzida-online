<script src="../src/global/ui-helper.js"></script>
<script src="../src/global/key-codes.js"></script>

<link rel="import" href="../extra/extra.html">
<link rel="import" href="ui-fragments/profiling-display.html">
<link rel="import" href="ui-fragments/respawnScreen.html">
<link rel="import" href="ui-fragments/join-battle-button.html">
<link rel="import" href="ui-fragments/respawnScreen.html">
<link rel="import" href="ui-fragments/action-bar.html">
<link rel="import" href="ui-fragments/cooldown-bar.html">
<link rel="import" href="ui-fragments/game-message.html">
<link rel="import" href="ui-fragments/loading-screen.html">
<link rel="import" href="ui-fragments/disconnected-screen.html">

<link rel="import" href="windows/join-battle-window.html">
<link rel="import" href="windows/survival-end-window.html">
<link rel="import" href="windows/login-window.html">
<link rel="import" href="windows/settings-window.html">
<link rel="import" href="windows/leaderboard-window.html">

<link rel="stylesheet" href="../styles/ui.css">
<link rel="stylesheet" href="../styles/icon.css">

<script src="../lib/requirejs/require.js"></script>

<template id="game-ui">
    <div class="ui-fragments"></div>
    <div class="window area"></div>
</template>

<script>
    (function (doc) {
        require(['components/game-ui'], function (GameUi) {
            document.registerElement('game-ui', {
                prototype: Object.create(HTMLElement.prototype, {
                    createdCallback: {
                        value: function () {
                            var main = doc.querySelector('#game-ui');
                            var mainElement = document.importNode(main.content, true);
                            this.appendChild(mainElement);
                        }
                    },
                    attachedCallback: {
                        value: function () {
                            // because element is created asynchronously due to use requireJs we need to emit event when it's has been propertly created.
                            this.dispatchEvent(new CustomEvent('element-attached'))
                        }
                    },
                    init: {
                        value: function (game) {
                            this.game = game;

                            const gameUi = GameUi.create(this, game.uiState);
                            this.gameUi = gameUi;
                            Object.keys(UiElements).forEach(function (elementKey) {
                                const element = UiElements[elementKey].prototype;
                                if (element.type == 'fragment') {
                                    gameUi.registerUiFragment(elementKey, element.properties);
                                } else if (element.type == 'window') {
                                    gameUi.registerWindow(elementKey, element.properties);
                                } else {
                                    throw `Ui element ${elementKey} has undefined type`;
                                }
                            });
                            gameUi.updateUi();
                        }
                    },
                    detachedCallback: {
                        value: function () {
                        }
                    },
                    showWindow: {
                        value: function (windowKey) {
                            this.gameUi.showWindow(windowKey)
                        }
                    },
                    hideWindow: {
                        value: function () {
                            this.gameUi.hideWindow()
                        }
                    },
                    toggleWindow: {
                        value: function (windowKey) {
                            this.gameUi.toggleWindow(windowKey)
                        }
                    }
                })
            });
        });
    })(document.currentScript.ownerDocument);
</script>